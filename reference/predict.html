<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Spatial model predictions — predict • terra</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Spatial model predictions — predict"><meta property="og:description" content="Make a SpatRaster object with predictions from a fitted model object (for example, obtained with glm or randomForest). The first argument is a SpatRaster object with the predictor variables. The names in the Raster object should exactly match those expected by the model. Any regression like model for which a predict method has been implemented (or can be implemented) can be used.
This approach of using model predictions is commonly used in remote sensing (for the classification of satellite images) and in ecology, for species distribution modeling."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">terra</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.5-23</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/rspatial/terra/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Spatial model predictions</h1>
    
    <div class="hidden name"><code>predict.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Make a SpatRaster object with predictions from a fitted model object (for example, obtained with <code>glm</code> or <code>randomForest</code>). The first argument is a SpatRaster object with the predictor variables. The <code><a href="names.html">names</a></code> in the Raster object should exactly match those expected by the model. Any regression like model for which a predict method has been implemented (or can be implemented) can be used.</p>
<p>This approach of using model predictions is commonly used in remote sensing (for the classification of satellite images) and in ecology, for species distribution modeling.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="co"># S4 method for SpatRaster</span>
<span class="fu">predict</span><span class="op">(</span><span class="va">object</span>, <span class="va">model</span>, fun<span class="op">=</span><span class="va">predict</span>, <span class="va">...</span>, factors<span class="op">=</span><span class="cn">NULL</span>, const<span class="op">=</span><span class="cn">NULL</span>, na.rm<span class="op">=</span><span class="cn">FALSE</span>,
          index<span class="op">=</span><span class="cn">NULL</span>, cores<span class="op">=</span><span class="fl">1</span>, cpkgs<span class="op">=</span><span class="cn">NULL</span>, filename<span class="op">=</span><span class="st">""</span>, overwrite<span class="op">=</span><span class="cn">FALSE</span>, wopt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>object</dt>
<dd><p>SpatRaster</p></dd>
<dt>model</dt>
<dd><p>fitted model of any class that has a "predict" method (or for which you can supply a similar method as <code>fun</code> argument. E.g. glm, gam, or randomForest</p></dd>
<dt>fun</dt>
<dd><p>function. The predict function that takes <code>model</code> as first argument. The default value is <code>predict</code>, but can be replaced with e.g. predict.se (depending on the type of model), or your own custom function</p></dd>
<dt>...</dt>
<dd><p>additional arguments for <code>fun</code></p></dd>
<dt>const</dt>
<dd><p>data.frame. Can be used to add a constant value as a predictor variable so that you do not need to make a SpatRaster layer for it</p></dd>
<dt>factors</dt>
<dd><p>list with levels for factor variables. The list elements should be named with names that correspond to names in <code>object</code> such that they can be matched. This argument may be omitted for standard models such as "glm" as the predict function will extract the levels from the <code>model</code> object, but it is necessary in some other cases (e.g. cforest models from the party package)</p></dd>
<dt>na.rm</dt>
<dd><p>logical. If <code>TRUE</code>, cells with <code>NA</code> values in the predictors are removed from the computation. This option prevents errors with models that cannot handle <code>NA</code> values. In most other cases this will not affect the output. An exception is when predicting with a model that returns predicted values even if some (or all!) variables are <code>NA</code></p></dd>
<dt>index</dt>
<dd><p>integer. To select subset of output variables</p></dd>
<dt>cores</dt>
<dd><p>positive integer. If <code>cores &gt; 1</code>, a 'parallel' package cluster with that many cores is created and used</p></dd>
<dt>cpkgs</dt>
<dd><p>character. The package(s) that need to be loaded on the nodes to be able to run the model.predict function (see examples)</p></dd>
<dt>filename</dt>
<dd><p>character. Output filename</p></dd>
<dt>overwrite</dt>
<dd><p>logical. If <code>TRUE</code>, <code>filename</code> is overwritten</p></dd>
<dt>wopt</dt>
<dd><p>list with named options for writing files as in <code><a href="writeRaster.html">writeRaster</a></code></p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>SpatRaster</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="va">logo</span> <span class="op">&lt;-</span> <span class="fu"><a href="rast.html">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"ex/logo.tif"</span>, package<span class="op">=</span><span class="st">"terra"</span><span class="op">)</span><span class="op">)</span>   </span>
<span class="r-in"><span class="fu"><a href="names.html">names</a></span><span class="op">(</span><span class="va">logo</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"blue"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="c.html">c</a></span><span class="op">(</span><span class="fl">48</span>, <span class="fl">48</span>, <span class="fl">48</span>, <span class="fl">53</span>, <span class="fl">50</span>, <span class="fl">46</span>, <span class="fl">54</span>, <span class="fl">70</span>, <span class="fl">84</span>, <span class="fl">85</span>, <span class="fl">74</span>, <span class="fl">84</span>, <span class="fl">95</span>, <span class="fl">85</span>, </span>
<span class="r-in">   <span class="fl">66</span>, <span class="fl">42</span>, <span class="fl">26</span>, <span class="fl">4</span>, <span class="fl">19</span>, <span class="fl">17</span>, <span class="fl">7</span>, <span class="fl">14</span>, <span class="fl">26</span>, <span class="fl">29</span>, <span class="fl">39</span>, <span class="fl">45</span>, <span class="fl">51</span>, <span class="fl">56</span>, <span class="fl">46</span>, <span class="fl">38</span>, <span class="fl">31</span>, </span>
<span class="r-in">   <span class="fl">22</span>, <span class="fl">34</span>, <span class="fl">60</span>, <span class="fl">70</span>, <span class="fl">73</span>, <span class="fl">63</span>, <span class="fl">46</span>, <span class="fl">43</span>, <span class="fl">28</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="c.html">c</a></span><span class="op">(</span><span class="fl">22</span>, <span class="fl">33</span>, <span class="fl">64</span>, <span class="fl">85</span>, <span class="fl">92</span>, <span class="fl">94</span>, <span class="fl">59</span>, <span class="fl">27</span>, <span class="fl">30</span>, <span class="fl">64</span>, <span class="fl">60</span>, <span class="fl">33</span>, <span class="fl">31</span>, <span class="fl">9</span>,</span>
<span class="r-in">   <span class="fl">99</span>, <span class="fl">67</span>, <span class="fl">15</span>, <span class="fl">5</span>, <span class="fl">4</span>, <span class="fl">30</span>, <span class="fl">8</span>, <span class="fl">37</span>, <span class="fl">42</span>, <span class="fl">27</span>, <span class="fl">19</span>, <span class="fl">69</span>, <span class="fl">60</span>, <span class="fl">73</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">21</span>,</span>
<span class="r-in">   <span class="fl">37</span>, <span class="fl">52</span>, <span class="fl">70</span>, <span class="fl">74</span>, <span class="fl">9</span>, <span class="fl">13</span>, <span class="fl">4</span>, <span class="fl">17</span>, <span class="fl">47</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">p</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">a</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># extract predictor values for points</span></span>
<span class="r-in"><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="extract.html">extract</a></span><span class="op">(</span><span class="va">logo</span>, <span class="va">xy</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># combine with response (excluding the ID column)</span></span>
<span class="r-in"><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>pa<span class="op">=</span><span class="va">xy</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">e</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">#build a model, here with glm </span></span>
<span class="r-in"><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span>formula<span class="op">=</span><span class="va">pa</span><span class="op">~</span><span class="va">.</span>, data<span class="op">=</span><span class="va">v</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">#predict to a raster</span></span>
<span class="r-in"><span class="va">r1</span> <span class="op">&lt;-</span> <span class="fu">predict</span><span class="op">(</span><span class="va">logo</span>, <span class="va">model</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">r1</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="lines.html">points</a></span><span class="op">(</span><span class="va">p</span>, bg<span class="op">=</span><span class="st">'blue'</span>, pch<span class="op">=</span><span class="fl">21</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="lines.html">points</a></span><span class="op">(</span><span class="va">a</span>, bg<span class="op">=</span><span class="st">'red'</span>, pch<span class="op">=</span><span class="fl">21</span><span class="op">)</span></span>
<span class="r-plt img"><img src="predict-1.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># logistic regression</span></span>
<span class="r-in"><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span>formula<span class="op">=</span><span class="va">pa</span><span class="op">~</span><span class="va">.</span>, data<span class="op">=</span><span class="va">v</span>, family<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>glm.fit: algorithm did not converge</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>glm.fit: fitted probabilities numerically 0 or 1 occurred</span>
<span class="r-in"><span class="va">r1log</span> <span class="op">&lt;-</span> <span class="fu">predict</span><span class="op">(</span><span class="va">logo</span>, <span class="va">model</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># use a modified function to get the probability and standard error</span></span>
<span class="r-in"><span class="co"># from the glm model. The values returned by "predict" are in a list,</span></span>
<span class="r-in"><span class="co"># and this list needs to be transformed to a matrix</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">predfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="va">v</span> <span class="op">&lt;-</span> <span class="fu">predict</span><span class="op">(</span><span class="va">model</span>, <span class="va">data</span>, se.fit<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in">  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>p<span class="op">=</span><span class="fu"><a href="coerce.html">as.vector</a></span><span class="op">(</span><span class="va">v</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span>, se<span class="op">=</span><span class="fu"><a href="coerce.html">as.vector</a></span><span class="op">(</span><span class="va">v</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">r2</span> <span class="op">&lt;-</span> <span class="fu">predict</span><span class="op">(</span><span class="va">logo</span>, <span class="va">model</span>, fun<span class="op">=</span><span class="va">predfun</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># principal components of a SpatRaster</span></span>
<span class="r-in"><span class="co"># here using sampling to simulate an object too large</span></span>
<span class="r-in"><span class="co"># to feed all its values to prcomp</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">sr</span> <span class="op">&lt;-</span> <span class="fu"><a href="values.html">values</a></span><span class="op">(</span><span class="fu"><a href="sample.html">spatSample</a></span><span class="op">(</span><span class="va">logo</span>, <span class="fl">100</span>, as.raster<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">sr</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">predict</span><span class="op">(</span><span class="va">logo</span>, <span class="va">pca</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span class="r-plt img"><img src="predict-2.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## parallelization</span></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="co">## simple case with GLM </span></span>
<span class="r-in"><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span>formula<span class="op">=</span><span class="va">pa</span><span class="op">~</span><span class="va">.</span>, data<span class="op">=</span><span class="va">v</span><span class="op">)</span></span>
<span class="r-in"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">predict</span><span class="op">(</span><span class="va">logo</span>, <span class="va">model</span>, cores<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## The above does not work with a model from a contributed</span></span>
<span class="r-in"><span class="co">## package, as the package needs to be loaded in each core. </span></span>
<span class="r-in"><span class="co">## Below are three approaches to deal with that </span></span>
<span class="r-in"></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.berkeley.edu/~breiman/RandomForests/" class="external-link">randomForest</a></span><span class="op">)</span></span>
<span class="r-in"><span class="va">rfm</span> <span class="op">&lt;-</span> <span class="fu">randomForest</span><span class="op">(</span>formula<span class="op">=</span><span class="va">pa</span><span class="op">~</span><span class="va">.</span>, data<span class="op">=</span><span class="va">v</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## approach 0 (not parallel) </span></span>
<span class="r-in"><span class="va">rp0</span> <span class="op">&lt;-</span> <span class="fu">predict</span><span class="op">(</span><span class="va">logo</span>, <span class="va">rfm</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## approach 1, use the "cpkgs" argument </span></span>
<span class="r-in"><span class="va">rp1</span> <span class="op">&lt;-</span> <span class="fu">predict</span><span class="op">(</span><span class="va">logo</span>, <span class="va">rfm</span>, cores<span class="op">=</span><span class="fl">2</span>, cpkgs<span class="op">=</span><span class="st">"randomForest"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## approach 2, write a custom predict function that loads the package</span></span>
<span class="r-in"><span class="va">rfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mod</span>, <span class="va">dat</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.berkeley.edu/~breiman/RandomForests/" class="external-link">randomForest</a></span><span class="op">)</span></span>
<span class="r-in">  <span class="fu">predict</span><span class="op">(</span><span class="va">mod</span>, <span class="va">dat</span>, <span class="va">...</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"><span class="va">rp2</span> <span class="op">&lt;-</span> <span class="fu">predict</span><span class="op">(</span><span class="va">logo</span>, <span class="va">rfm</span>, fun<span class="op">=</span><span class="va">rfun</span>, cores<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## approach 3, write a parallelized custom predict function </span></span>
<span class="r-in"><span class="va">rfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mod</span>, <span class="va">dat</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="va">ncls</span> <span class="op">&lt;-</span> <span class="fu"><a href="dimensions.html">length</a></span><span class="op">(</span><span class="va">cls</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">nr</span> <span class="op">&lt;-</span> <span class="fu"><a href="dimensions.html">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="split.html">split</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">ncls</span>, each<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">nr</span><span class="op">/</span><span class="va">ncls</span><span class="op">)</span>, length.out<span class="op">=</span><span class="va">nr</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in">  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span>  <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">clusterApply</a></span><span class="op">(</span><span class="va">cls</span>, <span class="va">s</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="fu">predict</span><span class="op">(</span><span class="va">mod</span>, <span class="va">x</span>, <span class="va">...</span><span class="op">)</span><span class="op">)</span>  <span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span>
<span class="r-in"><span class="va">cls</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span class="r-in"><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">clusterExport</a></span><span class="op">(</span><span class="va">cls</span>, <span class="fu"><a href="c.html">c</a></span><span class="op">(</span><span class="st">"rfm"</span>, <span class="st">"rfun"</span>, <span class="st">"randomForest"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">rp3</span> <span class="op">&lt;-</span> <span class="fu">predict</span><span class="op">(</span><span class="va">logo</span>, <span class="va">rfm</span>, fun<span class="op">=</span><span class="va">rfun</span><span class="op">)</span></span>
<span class="r-in"><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cls</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="c.html">c</a></span><span class="op">(</span><span class="va">rp0</span>, <span class="va">rp1</span>, <span class="va">rp2</span>, <span class="va">rp3</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">### with two output variables (probabilities for each class)</span></span>
<span class="r-in"><span class="va">v</span><span class="op">$</span><span class="va">pa</span> <span class="op">&lt;-</span> <span class="fu"><a href="factors.html">as.factor</a></span><span class="op">(</span><span class="va">v</span><span class="op">$</span><span class="va">pa</span><span class="op">)</span></span>
<span class="r-in"><span class="va">rfm2</span> <span class="op">&lt;-</span> <span class="fu">randomForest</span><span class="op">(</span>formula<span class="op">=</span><span class="va">pa</span><span class="op">~</span><span class="va">.</span>, data<span class="op">=</span><span class="va">v</span><span class="op">)</span></span>
<span class="r-in"><span class="va">rfp</span> <span class="op">&lt;-</span> <span class="fu">predict</span><span class="op">(</span><span class="va">logo</span>, <span class="va">rfm2</span>, cores<span class="op">=</span><span class="fl">2</span>, type<span class="op">=</span><span class="st">"prob"</span>, cpkgs<span class="op">=</span><span class="st">"randomForest"</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Robert J. Hijmans.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

