<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Detect patches (clumps) of cells — patches • terra</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Detect patches (clumps) of cells — patches"><meta name="description" content="Detect patches (clumps). Patches are groups of cells that are surrounded by cells that are NA. Set zeroAsNA to TRUE to also identify patches separated by cells with values of zero."><meta property="og:description" content="Detect patches (clumps). Patches are groups of cells that are surrounded by cells that are NA. Set zeroAsNA to TRUE to also identify patches separated by cells with values of zero."><meta property="og:image" content="https://rspatial.github.io/terra/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">terra</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.8-3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../reference/terra-package.html">Description</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://rspatial.org">Tutorials</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rspatial/terra/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Detect patches (clumps) of cells</h1>

      <div class="d-none name"><code>patches.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Detect patches (clumps). Patches are groups of cells that are surrounded by cells that are <code>NA</code>. Set <code>zeroAsNA</code> to <code>TRUE</code> to also identify patches separated by cells with values of zero.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S4 method for class 'SpatRaster'</span></span>
<span><span class="fu">patches</span><span class="op">(</span><span class="va">x</span>, directions<span class="op">=</span><span class="fl">4</span>, values<span class="op">=</span><span class="cn">FALSE</span>, zeroAsNA<span class="op">=</span><span class="cn">FALSE</span>, allowGaps<span class="op">=</span><span class="cn">TRUE</span>, filename<span class="op">=</span><span class="st">""</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>SpatRaster</p></dd>

<dt id="arg-directions">directions<a class="anchor" aria-label="anchor" href="#arg-directions"></a></dt>
<dd><p>integer indicating which cells are considered adjacent. Should be 8 (Queen's case) or 4 (Rook's case)</p></dd>

  <dt id="arg-values">values<a class="anchor" aria-label="anchor" href="#arg-values"></a></dt>
<dd><p>logical. If <code>TRUE</code> use cell values to distinguish patches. If <code>FALSE</code>, all cells that are not <code>NA</code> are considered identical</p></dd>

  <dt id="arg-zeroasna">zeroAsNA<a class="anchor" aria-label="anchor" href="#arg-zeroasna"></a></dt>
<dd><p>logical. If <code>TRUE</code> treat cells that are zero as if they were <code>NA</code>. Ignored if <code>byvalue=TRUE</code></p></dd>

  <dt id="arg-allowgaps">allowGaps<a class="anchor" aria-label="anchor" href="#arg-allowgaps"></a></dt>
<dd><p>logical. If <code>TRUE</code> there may be gaps in the patch IDs (e.g. you may have patch IDs 1, 2, 3 and 5, but not 4). If it is FALSE, these numbers will be recoded from 1 to the number of patches (4 in this example)</p></dd>

  <dt id="arg-filename">filename<a class="anchor" aria-label="anchor" href="#arg-filename"></a></dt>
<dd><p>character. Output filename</p></dd>

  <dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>options for writing files as in <code><a href="writeRaster.html">writeRaster</a></code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>SpatRaster. Cell values are patch numbers</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="focal.html">focal</a></code>, <code><a href="boundaries.html">boundaries</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="rast.html">rast</a></span><span class="op">(</span>nrows<span class="op">=</span><span class="fl">18</span>, ncols<span class="op">=</span><span class="fl">36</span>, xmin<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">r</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="va">r</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">8</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="va">r</span><span class="op">[</span><span class="fl">7</span><span class="op">:</span><span class="fl">12</span>, <span class="fl">22</span><span class="op">:</span><span class="fl">36</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="va">r</span><span class="op">[</span><span class="fl">15</span><span class="op">:</span><span class="fl">16</span>, <span class="fl">18</span><span class="op">:</span><span class="fl">29</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">patches</span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># zero as background instead of NA</span></span></span>
<span class="r-in"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="rast.html">rast</a></span><span class="op">(</span>nrows<span class="op">=</span><span class="fl">10</span>, ncols<span class="op">=</span><span class="fl">10</span>, xmin<span class="op">=</span><span class="fl">0</span>, vals<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">r</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></span>
<span class="r-in"><span><span class="va">r</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></span>
<span class="r-in"><span><span class="va">r</span><span class="op">[</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">12</span></span></span>
<span class="r-in"><span><span class="va">r</span><span class="op">[</span><span class="fl">6</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">9</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">12</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># treat zeros as NA</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu">patches</span><span class="op">(</span><span class="va">r</span>, zeroAsNA<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p8</span> <span class="op">&lt;-</span> <span class="fu">patches</span><span class="op">(</span><span class="va">r</span>, <span class="fl">8</span>, zeroAsNA<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### patches for different values</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">patches</span><span class="op">(</span><span class="va">r</span>, values<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### patch ID values are not guaranteed to be consecutive</span></span></span>
<span class="r-in"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="rast.html">rast</a></span><span class="op">(</span>nrows<span class="op">=</span><span class="fl">5</span>, ncols<span class="op">=</span><span class="fl">10</span>, xmin<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="values.html">values</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="dimensions.html">ncell</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fl">0.7</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rp</span> <span class="op">&lt;-</span> <span class="fu">patches</span><span class="op">(</span><span class="va">r</span>, directions<span class="op">=</span><span class="fl">8</span>, zeroAsNA<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">rp</span>, type<span class="op">=</span><span class="st">"classes"</span><span class="op">)</span>; <span class="fu"><a href="text.html">text</a></span><span class="op">(</span><span class="va">rp</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="patches-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## unless you set allowGaps=FALSE</span></span></span>
<span class="r-in"><span><span class="va">rp</span> <span class="op">&lt;-</span> <span class="fu">patches</span><span class="op">(</span><span class="va">r</span>, directions<span class="op">=</span><span class="fl">8</span>, zeroAsNA<span class="op">=</span><span class="cn">TRUE</span>, allowGaps<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">rp</span>, type<span class="op">=</span><span class="st">"classes"</span><span class="op">)</span>; <span class="fu"><a href="text.html">text</a></span><span class="op">(</span><span class="va">rp</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="patches-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### use zonal to remove small patches </span></span></span>
<span class="r-in"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"ex/elev.tif"</span>, package<span class="op">=</span><span class="st">"terra"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="rast.html">rast</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="classify.html">classify</a></span><span class="op">(</span><span class="va">r</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fl">400</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">patches</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># remove patches smaller than 100 ha</span></span></span>
<span class="r-in"><span><span class="va">rz</span> <span class="op">&lt;-</span> <span class="fu"><a href="zonal.html">zonal</a></span><span class="op">(</span><span class="fu"><a href="cellSize.html">cellSize</a></span><span class="op">(</span><span class="va">y</span>, unit<span class="op">=</span><span class="st">"ha"</span><span class="op">)</span>, <span class="va">y</span>, <span class="va">sum</span>, as.raster<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="ifelse.html">ifel</a></span><span class="op">(</span><span class="va">rz</span> <span class="op">&lt;</span> <span class="fl">250</span>, <span class="cn">NA</span>, <span class="va">y</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robert J. Hijmans.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

